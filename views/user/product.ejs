<%- include('../layout/start') %>
    <%- include('../layout/navbar',{x}) %>
        <!-- Breadcrumb Section Begin -->
        <section class="breadcrumb-option">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="breadcrumb__text">
                            <h4>Shop</h4>
                            <div class="breadcrumb__links">
                                <a href="./index.html">Home</a>
                                <span>Shop</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Shop Section Begin -->
        <section class="shop spad pt-3">
            <div class="container-fuild mx-4">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="shop__sidebar">
                            <div class="shop__sidebar__search">
                                <form action="#">
                                    <input onkeyup="filtersearch()" id="search" type="text" placeholder="Search...">
                                    <button type="submit"><span class="icon_search"></span></button>
                                </form>
                            </div>
                            <div class="shop__sidebar__accordion">
                                <div class="accordion" id="accordionExample">
                                    <div class="card">
                                        <div class="card-heading">
                                            <a data-toggle="collapse" data-target="#collapseOne">Categories</a>
                                        </div>
                                        <div id="collapseOne" class="collapse show" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <div class="shop__sidebar__categories">
                                                    <ul class="nice-scroll " style="height: 100px">
                                                        <% cate_Data.forEach(element=> {%>
                                                            <li style="height: 30px;"
                                                                class=" d-flex justify-content-start align-items-center">
                                                                <input onclick="category('<%=element.category%>')"
                                                                    value="<%=element.category%>"
                                                                    id="<%=element.category%>" class="mx-2"
                                                                    type="checkbox">
                                                                <label class="m-0 text-uppercase " for="">
                                                                    <%= element.category %>
                                                                </label>
                                                            </li>
                                                            <% }); %>

                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-heading">
                                            <a data-toggle="collapse" data-target="#collapseTwo">Branding</a>
                                        </div>
                                        <div id="collapseTwo" class="collapse show" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <div class="shop__sidebar__brand">
                                                    <ul>
                                                        <%barnd.forEach(element=> { %>
                                                            <li>
                                                                <input onclick="brand('<%=element%>')" id="<%=element%>"
                                                                    value="<%= element%>" class="mx-2" type="checkbox">
                                                                <label class="m-0 text-uppercase " for="">
                                                                    <%= element%>
                                                                </label>

                                                            </li>
                                                            <% }); %>


                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-heading">
                                            <a data-toggle="collapse" data-target="#collapseThree">Filter Price</a>
                                        </div>
                                        <div id="collapseThree" class="collapse show" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <div class="shop__sidebar__price">
                                                    <ul>
                                                        <li>
                                                            <input onclick="price(1)" id="ONE" value="0,999" type="checkbox">
                                                            <label for="">₹0.00 - 999</label>
                                                        </li>
                                                        <li>
                                                            <input onclick="price(2)" id="TWO" value="1000,1999" type="checkbox">
                                                            <label for="">₹1000 - 1999</label>
                                                        </li>
                                                        <li>
                                                            <input onclick="price(3)" id="THREE" value="2000,4999" type="checkbox">
                                                            <label for="">₹2000 - 4999</label>
                                                        </li>
                                                        <li>
                                                            <input onclick="price(4)" id="FORE"  value="5000" type="checkbox">
                                                            <label for="">₹5000-ABOUVE</label>
                                                        </li>

                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                 
                                        
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- //////////////////////////////////// -->
                    <div class="col-lg-9 m-0 p-0 px-1">
                      
                        <div id="Filter" class="row d-flex justify-content-center">
                            <%pro_Data.forEach((element,i)=> { %>

                                <div  class="col-6  col-lg-4 col-md-4 col-sm-6 col-xl-3 ">
                                    <a href="/product-deatil?id=<%=element._id %>">
                                        <div class="product__item">
                                            <div class="product__item__pic set-bg">
                                                <img style="border: solid 1px black;" class=" radius h-100 w-100" src="product/<%= element.image[0] %>" alt="">
                                                <ul class="product__hover">
                                                    <li><a href="/wishlist?id=<%=element._id %>"><img src="img/icon/heart.png" alt=""></a></li>
                                                </ul>
                                            </div>
                                            <div class="product__item__text m-0 p-0 ">
                                                <h6 class="mt-2">
                                                    <%=element.brand%>
                                                </h6>
                                                <p class="mb-1">
                                                    <%=element.title%>
                                                </p>
                                              
                                                <h5><span class="">₹<%=element.price%><span class="text-success mx-2">
                                                        <%=(Math.round((element.discount*100) /element.price))%>% off
                                                    </span></h5>

                                            </div>
                                        </div>
                                    </a>
                                </div>

                                <% }) %>
                        </div>

                       </div>
                       <div class="col-lg-3"></div>
                       <div class="col-lg-9 m-0 p-0">
                        <div class="d-flex justify-content-center">
                            <nav aria-label="Page navigation example">
                                <ul class="pagination">
                                  <li class="page-item">
                                    <p class="page-link" aria-label="Previous">
                                      <span aria-hidden="true">&laquo;</span>
                                    </p>
                                  </li>
                                  <i class="d-flex m-0 p-0" id="pagination">
                                  <% for(let i=0;i<length;i++) {%>
                                  <li class="page-item"><p class="page-link" onclick="page('<%=i+1%>')"><%= i+1 %></p></li>
                                  <% } %>
                                  </i>
                                  <li class="page-item">
                                    <p class="page-link" aria-label="Next">
                                      <span aria-hidden="true">&raquo;</span>
                                    </p>
                                  </li>
                                </ul>
                              </nav>
                        </div>
                        </div>

                        <!-- Shop Section End -->
                        <%- include('../layout/end') %>
                            <script>
                                let n = 0
                                let b = 0
                                let categorys = []
                                let brands = []
                                let search
                                let Page
                                let prices=[]
                                let filterprice=[]
                                function page(p){
                                
                                 console.log(43);
                                 submit(categorys,brands,search,filterprice,p)
                                }
                                function category(ID) {

                                    if ($(`#${ID}`).is(':checked') == true) {
                                        categorys[n] = $(`#${ID}`).val()
                                        n++
                                        console.log(categorys);
                                        console.log($(`#${ID}`).is(':checked'))
                                    } else {
                                        console.log($(`#${ID}`).is(':checked'))
                                        console.log(categorys.indexOf(`${$(`#${ID}`).val()}`));
                                        let index = categorys.indexOf(`${$(`#${ID}`).val()}`)
                                        categorys.splice(index, 1)
                                        n--
                                        console.log(categorys);
                                    }
                                    submit(categorys, brands, search,filterprice,Page)

                                }
                                function submit(categorys,brands,search,filterprice,P) {
                                    $.ajax({
                                        url: '/product-filter?page='+P,
                                        type: 'post',
                                        dataType: 'json',
                                        contentType: 'application/json',
                                        data: JSON.stringify({ categorys, brands, search ,filterprice}),
                                        success: (res) => {
                                            let html = []
                                            if (res.data) {
                                                console.log(res.data);
                                                $('#Filter').html('')
                                                res.data.forEach(value => {
                                                    value.forEach((element, i) => {
                                                        html += ` <div  class="col-6  col-lg-4 col-md-4 col-sm-6 col-xl-3 px-2">
                                    <a href="/product-deatil?id=${element._id}">
                                        <div class="product__item">
                                            <div class="product__item__pic set-bg">
                                                <img style="border: solid 1px black;" class=" radius h-100 w-100" src="product/${element.image[0]}" alt="">
                                                <ul class="product__hover">
                                                    <li><a href="/wishlist?id=${element._id}"><img src="img/icon/heart.png" alt=""></a></li>
                                                </ul>
                                            </div>
                                            <div class="product__item__text m-0 p-0 ">
                                                <h6 class="mt-2">
                                                    ${element.brand}
                                                </h6>
                                                <p class="mb-1">
                                                    ${element.title}
                                                </p>
                                              
                                                <h5><span class="">₹${element.price}<span class="text-success mx-2">
                                                        ${(Math.round((element.discount*100) /element.price))}% off
                                                    </span></h5>

                                            </div>
                                        </div>
                                    </a>
                                </div>`

                                                    })

                                                });

                                                $('#Filter').html(html)




                                            }
                                             let pagination=[]
                                            if(res.Length){
                                                console.log(res.Length);
                                                $('#pagination').html('')
                                                for(let j=0;j<res.Length;j++){
                                                    pagination+=`<li class="page-item"><p class="page-link" onclick="page('${j+1}')">${j+1}</p></li>`
                                                }
                                                $('#pagination').html(pagination)

                                            }
                                        }
                                    })
                                }



                                function brand(ID) {
                                    if ($(`#${ID}`).is(':checked') == true) {
                                        brands[b++] = $(`#${ID}`).val()
                                    } else {
                                        const index = brands.indexOf($(`#${ID}`).val())
                                        brands.splice(index, 1)
                                        b--
                                    }
                                    submit(categorys, brands, search,filterprice,Page)
                                }

                                function filtersearch() {
                                    search = $('#search').val()
                                    submit(categorys, brands, search,filterprice,Page)
                                }
                                function price(check){
                                    filterprice=[]
                                    let one,two,three,fore
                                    let n=0,index
                                    if($("#ONE").is(':checked')==true){
                                     one=$("#ONE").val()
                                     prices[n]=one
                                     n++
                                    }else if(check==1){
                                        index=prices.indexOf($("#ONE").val())
                                        prices.splice(index,1)
                                        
                                    }
                                    if($("#TWO").is(':checked')==true){
                                        two=$("#TWO").val()
                                        prices[n]=two
                                        n++
                                    }else if(check==2){
                                        index=prices.indexOf($("#TWO").val())
                                        prices.splice(index,1)
                                        
                                    }
                                    if($("#THREE").is(':checked')==true){
                                        three=$("#THREE").val()
                                        prices[n]=three
                                        n++
                                    }else if(check==3){
                                        index=prices.indexOf($("#THREE").val())
                                        prices.splice(index,1)
                                    
                                    }
                                    if($("#FORE").is(':checked')==true){
                                        fore=$("#FORE").val()
                                        prices[n]=fore
                                        n++
                                    }else if(check==4){
                                        index=prices.indexOf($("#FORE").val())
                                        prices.splice(index,1)
                                        
                                    }
                                    let length
                                    if (prices) {
                                         length=prices.length
                                    }
                                   
                                //    console.log(prices[length-1].split(',').length)
                                    if(prices.length==1&&prices[length-1].split(',').length==2){
                                        let first=[prices[length-1]]
                                        first=first[0].split(',')
        
                                        filterprice[0]=first[0]
                                        filterprice[1]=first[1]
                                        
                                    }else if(prices.length==1&&prices[length-1].split(',').length==1){
                                        console.log('50000');
                                        let first=[]
                                         first[0]=prices[0]
                                       filterprice[0]=first[0]
                                        console.log(filterprice);
                                    }else if(prices.length>1&&prices[length-1].split(',').length==2) {
                                        let first=[prices[0]]
                                        let second=[prices[length-1]]
                                    first=first[0].split(',')
                                    second=second[0].split(',')
                                    filterprice[0]=first[0]
                                    filterprice[1]=second[1]
                                        console.log(filterprice);
                                    }else if(prices.length>1&&prices[length-1].split(',').length==1){
                                        let first=[prices[0]]
                                    first=first[0].split(',')
                                    filterprice[0]=first[0]
                                        console.log(filterprice);
                                        console.log('dhcf');
                                    }
                                    submit(categorys, brands, search,filterprice,Page)
                                    
                                }
                            </script>